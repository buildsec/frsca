- op: add
  path: /spec/steps/0
  value:
    name: get-latest-cve-findings
    image: $(params.TRIVY_IMAGE)
    script: |
      TRIVY_TEMP_DIR=$(mktemp -d)
      trivy --cache-dir $TRIVY_TEMP_DIR image --download-db-only
      tar -cf ./db.tar.gz -C $TRIVY_TEMP_DIR/db metadata.json trivy.db
      rm -rf $TRIVY_TEMP_DIR
      tar xvf ./db.tar.gz -C /home/tekton/.cache/trivy/db
- op: test
  path: /spec/steps/1/name
  value: trivy-scan
- op: add
  path: /spec/steps/1/volumeMounts
  value:
    - mountPath: /etc/ssl/certs/ca-certificates.crt
      name: ca-certs
      subPath: ca-certificates.crt
      readOnly: true
- op: add
  path: /spec/volumes
  value:
    - configMap:
        name: ca-certs
      name: ca-certs
