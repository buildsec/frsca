# spire-agent

![Version: 0.1.0](https://img.shields.io/badge/Version-0.1.0-informational?style=flat-square) ![Type: application](https://img.shields.io/badge/Type-application-informational?style=flat-square) ![AppVersion: 1.7.2](https://img.shields.io/badge/AppVersion-1.7.2-informational?style=flat-square)

A Helm chart to install the SPIRE agent.

**Homepage:** <https://github.com/spiffe/helm-charts-hardened/tree/main/charts/spire>

## Maintainers

| Name | Email | Url |
| ---- | ------ | --- |
| marcofranssen | <marco.franssen@gmail.com> | <https://marcofranssen.nl> |
| kfox1111 | <Kevin.Fox@pnnl.gov> |  |
| faisal-memon | <fymemon@yahoo.com> |  |
| edwbuck | <edwbuck@gmail.com> |  |

## Source Code

* <https://github.com/spiffe/helm-charts-hardened/tree/main/charts/spire>

<!-- The parameters section is generated using helm-docs.sh and should not be edited by hand. -->

## Parameters

### Chart parameters

| Name                                              | Description                                                                                                                                                                                       | Value                                                                            |
| ------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| `image.registry`                                  | The OCI registry to pull the image from                                                                                                                                                           | `ghcr.io`                                                                        |
| `image.repository`                                | The repository within the registry                                                                                                                                                                | `spiffe/spire-agent`                                                             |
| `image.pullPolicy`                                | The image pull policy                                                                                                                                                                             | `IfNotPresent`                                                                   |
| `image.tag`                                       | Overrides the image tag whose default is the chart appVersion                                                                                                                                     | `""`                                                                             |
| `imagePullSecrets`                                | Pull secrets for images                                                                                                                                                                           | `[]`                                                                             |
| `nameOverride`                                    | Name override                                                                                                                                                                                     | `""`                                                                             |
| `namespaceOverride`                               | Namespace override                                                                                                                                                                                | `""`                                                                             |
| `fullnameOverride`                                | Fullname override                                                                                                                                                                                 | `""`                                                                             |
| `serviceAccount.create`                           | Specifies whether a service account should be created                                                                                                                                             | `true`                                                                           |
| `serviceAccount.annotations`                      | Annotations to add to the service account                                                                                                                                                         | `{}`                                                                             |
| `serviceAccount.name`                             | The name of the service account to use.                                                                                                                                                           | `""`                                                                             |
| `configMap.annotations`                           | Annotations to add to the SPIRE Agent ConfigMap                                                                                                                                                   | `{}`                                                                             |
| `podAnnotations`                                  | Annotations to add to pods                                                                                                                                                                        | `{}`                                                                             |
| `podLabels`                                       | Labels to add to pods                                                                                                                                                                             | `{}`                                                                             |
| `podSecurityContext`                              | Pod security context                                                                                                                                                                              | `{}`                                                                             |
| `securityContext`                                 | Security context                                                                                                                                                                                  | `{}`                                                                             |
| `resources`                                       | Resource requests and limits                                                                                                                                                                      | `{}`                                                                             |
| `nodeSelector`                                    | Node selector                                                                                                                                                                                     | `{}`                                                                             |
| `tolerations`                                     | List of tolerations                                                                                                                                                                               | `[]`                                                                             |
| `affinity`                                        | Node affinity                                                                                                                                                                                     | `{}`                                                                             |
| `authorizedDelegates`                             | A list of the authorized delegates SPIFFE IDs. See Delegated Identity API for more information.                                                                                                   | `[]`                                                                             |
| `logLevel`                                        | The log level, valid values are "debug", "info", "warn", and "error"                                                                                                                              | `info`                                                                           |
| `clusterName`                                     | The name of the Kubernetes cluster (`kubeadm init --service-dns-domain`)                                                                                                                          | `example-cluster`                                                                |
| `trustDomain`                                     | The trust domain to be used for the SPIFFE identifiers                                                                                                                                            | `example.org`                                                                    |
| `trustBundleURL`                                  | If set, obtain trust bundle from url instead of Kubernetes ConfigMap                                                                                                                              | `""`                                                                             |
| `trustBundleFormat`                               | If using trustBundleURL, what format is the url. Choices are "pem" and "spiffe"                                                                                                                   | `pem`                                                                            |
| `bundleConfigMap`                                 | Configmap name for Spire bundle                                                                                                                                                                   | `spire-bundle`                                                                   |
| `availabilityTarget`                              | The minimum amount of time desired to gracefully handle SPIRE Server or Agent downtime. This configurable influences how aggressively X509 SVIDs should be rotated. If set, must be at least 24h. | `""`                                                                             |
| `disableReattestToRenew`                          | Deprecated: Allow agent to renew certificate when it expires rather than reattest                                                                                                                 | `false`                                                                          |
| `server.address`                                  | Address for Spire server                                                                                                                                                                          | `""`                                                                             |
| `server.port`                                     | Port number for Spire server                                                                                                                                                                      | `8081`                                                                           |
| `server.namespaceOverride`                        | Override the namespace for Spire server                                                                                                                                                           | `""`                                                                             |
| `server.nameOverride`                             | Override the name for Spire server. Should only be changed when building your own nested chart to ensure names align.                                                                             | `""`                                                                             |
| `healthChecks.port`                               | override the host port used for health checking                                                                                                                                                   | `9982`                                                                           |
| `updateStrategy.type`                             | The update strategy to use to replace existing DaemonSet pods with new pods. Can be RollingUpdate or OnDelete.                                                                                    | `RollingUpdate`                                                                  |
| `updateStrategy.rollingUpdate.maxUnavailable`     | Max unavailable pods during update. Can be a number or a percentage.                                                                                                                              | `1`                                                                              |
| `livenessProbe.initialDelaySeconds`               | Initial delay seconds for probe                                                                                                                                                                   | `15`                                                                             |
| `livenessProbe.periodSeconds`                     | Period seconds for probe                                                                                                                                                                          | `60`                                                                             |
| `readinessProbe.initialDelaySeconds`              | Initial delay seconds for probe                                                                                                                                                                   | `10`                                                                             |
| `readinessProbe.periodSeconds`                    | Period seconds for probe                                                                                                                                                                          | `30`                                                                             |
| `fsGroupFix.image.registry`                       | The OCI registry to pull the image from                                                                                                                                                           | `cgr.dev`                                                                        |
| `fsGroupFix.image.repository`                     | The repository within the registry                                                                                                                                                                | `chainguard/bash`                                                                |
| `fsGroupFix.image.pullPolicy`                     | The image pull policy                                                                                                                                                                             | `Always`                                                                         |
| `fsGroupFix.image.tag`                            | Overrides the image tag whose default is the chart appVersion                                                                                                                                     | `latest@sha256:5921884408efe50b77796675dc109ad2126f54476fe7403c37d8898a5ceb2e76` |
| `fsGroupFix.resources`                            | Specify resource needs as per https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/                                                                                      | `{}`                                                                             |
| `keyManager.memory.enabled`                       | Enable the memory based Key Manager                                                                                                                                                               | `true`                                                                           |
| `nodeAttestor.k8sPsat.enabled`                    | Enable Psat k8s Node Attestor                                                                                                                                                                     | `true`                                                                           |
| `nodeAttestor.tpmDirect.enabled`                  | Enable the direct TPM node attestor, a 3rd party plugin by Boxboat. This plugin is experimental.                                                                                                  | `false`                                                                          |
| `nodeAttestor.tpmDirect.plugin.image.registry`    | The OCI registry to pull the image from                                                                                                                                                           | `docker.io`                                                                      |
| `nodeAttestor.tpmDirect.plugin.image.repository`  | The repository within the registry                                                                                                                                                                | `boxboat/spire-tpm-plugin-tpm-attestor-agent`                                    |
| `nodeAttestor.tpmDirect.plugin.image.pullPolicy`  | The image pull policy                                                                                                                                                                             | `IfNotPresent`                                                                   |
| `nodeAttestor.tpmDirect.plugin.image.tag`         | Overrides the image tag                                                                                                                                                                           | `v1.8.7`                                                                         |
| `nodeAttestor.tpmDirect.plugin.checksum`          | The sha256 checksum of the plugin binary                                                                                                                                                          | `1d7c73ccac948ee86cbd78ddde2d30128a1838b403f7bb2100d38d916a252244`               |
| `nodeAttestor.tpmDirect.plugin.path`              | The filename in the container of the plugin                                                                                                                                                       | `/app/tpm_attestor_agent`                                                        |
| `nodeAttestor.tpmDirect.pubHash.enabled`          | Enable Psat k8s nodeattestor                                                                                                                                                                      | `true`                                                                           |
| `nodeAttestor.tpmDirect.pubHash.image.registry`   | The OCI registry to pull the image from                                                                                                                                                           | `docker.io`                                                                      |
| `nodeAttestor.tpmDirect.pubHash.image.repository` | The repository within the registry                                                                                                                                                                | `boxboat/spire-tpm-plugin-get-tpm-pubhash`                                       |
| `nodeAttestor.tpmDirect.pubHash.image.pullPolicy` | The image pull policy                                                                                                                                                                             | `IfNotPresent`                                                                   |
| `nodeAttestor.tpmDirect.pubHash.image.tag`        | Overrides the image tag                                                                                                                                                                           | `v1.8.7`                                                                         |
| `workloadAttestors.unix.enabled`                  | Enables the Unix workload attestor                                                                                                                                                                | `false`                                                                          |
| `workloadAttestors.k8s.enabled`                   | Enables the Kubernetes workload attestor                                                                                                                                                          | `true`                                                                           |
| `workloadAttestors.k8s.skipKubeletVerification`   | If true, kubelet certificate verification is skipped                                                                                                                                              | `true`                                                                           |
| `workloadAttestors.k8s.disableContainerSelectors` | Set to true if using holdApplicationUntilProxyStarts in Istio                                                                                                                                     | `false`                                                                          |
| `sds.enabled`                                     | Enables Envoy SDS configuration                                                                                                                                                                   | `false`                                                                          |
| `sds.defaultSvidName`                             | The TLS Certificate resource name to use for the default X509-SVID with Envoy SDS                                                                                                                 | `default`                                                                        |
| `sds.defaultBundleName`                           | The Validation Context resource name to use for the default X.509 bundle with Envoy SDS                                                                                                           | `ROOTCA`                                                                         |
| `sds.defaultAllBundlesName`                       | The Validation Context resource name to use for all bundles (including federated) with Envoy SDS                                                                                                  | `ALL`                                                                            |
| `sds.disableSpiffeCertValidation`                 | Disable Envoy SDS custom validation                                                                                                                                                               | `false`                                                                          |
| `telemetry.prometheus.enabled`                    | Flag to enable prometheus monitoring                                                                                                                                                              | `false`                                                                          |
| `telemetry.prometheus.port`                       | Port for prometheus metrics                                                                                                                                                                       | `9988`                                                                           |
| `telemetry.prometheus.podMonitor.enabled`         | Enable podMonitor for prometheus                                                                                                                                                                  | `false`                                                                          |
| `telemetry.prometheus.podMonitor.namespace`       | Override where to install the podMonitor, if not set will use the same namespace as the spire-agent                                                                                               | `""`                                                                             |
| `telemetry.prometheus.podMonitor.labels`          | Pod labels to filter for prometheus monitoring                                                                                                                                                    | `{}`                                                                             |
| `kubeletConnectByHostname`                        | If true, connect to kubelet using the nodes hostname. If false, uses localhost. If unset, defaults to true on OpenShift and false otherwise.                                                      | `""`                                                                             |
| `socketPath`                                      | The unix socket path to the spire-agent                                                                                                                                                           | `/run/spire/agent-sockets/spire-agent.sock`                                      |
| `socketAlternate.names`                           | List of alternate names for the socket that workloads might expect to be able to access in the driver mount.                                                                                      | `["socket","spire-agent.sock","api.sock"]`                                       |
| `socketAlternate.image.registry`                  | The OCI registry to pull the image from                                                                                                                                                           | `cgr.dev`                                                                        |
| `socketAlternate.image.repository`                | The repository within the registry                                                                                                                                                                | `chainguard/bash`                                                                |
| `socketAlternate.image.pullPolicy`                | The image pull policy                                                                                                                                                                             | `Always`                                                                         |
| `socketAlternate.image.tag`                       | Overrides the image tag whose default is the chart appVersion                                                                                                                                     | `latest@sha256:5921884408efe50b77796675dc109ad2126f54476fe7403c37d8898a5ceb2e76` |
| `socketAlternate.resources`                       | Specify resource needs as per https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/                                                                                      | `{}`                                                                             |
| `priorityClassName`                               | Priority class assigned to daemonset pods. Can be auto set with global.recommendations.priorityClassName.                                                                                         | `""`                                                                             |
| `extraEnvVars`                                    | Extra environment variables to be added to the Spire Agent container                                                                                                                              | `[]`                                                                             |
| `extraVolumes`                                    | Extra volumes to be mounted on Spire Agent pods                                                                                                                                                   | `[]`                                                                             |
| `extraVolumeMounts`                               | Extra volume mounts for Spire Agent pods                                                                                                                                                          | `[]`                                                                             |
| `extraContainers`                                 | Additional containers to create with Spire Agent pods                                                                                                                                             | `[]`                                                                             |
| `initContainers`                                  | Additional init containers to create with Spire Agent pods                                                                                                                                        | `[]`                                                                             |
| `hostAliases`                                     | Customize /etc/hosts file as described here https://kubernetes.io/docs/tasks/network/customize-hosts-file-for-pods/                                                                               | `[]`                                                                             |
| `customPlugins.keyManager`                        | Custom plugins of type KeyManager are configured here                                                                                                                                             | `{}`                                                                             |
| `customPlugins.nodeAttestor`                      | Custom plugins of type NodeAttestor are configured here                                                                                                                                           | `{}`                                                                             |
| `customPlugins.svidStore`                         | Custom plugins of type SVIDStore are configured here                                                                                                                                              | `{}`                                                                             |
| `customPlugins.workloadAttestor`                  | Custom plugins of type WorkloadAttestor are configured here                                                                                                                                       | `{}`                                                                             |
| `experimental.enabled`                            | Allow configuration of experimental features                                                                                                                                                      | `false`                                                                          |
| `experimental.syncInterval`                       | Sync interval with SPIRE server with exponential backoff                                                                                                                                          | `5s`                                                                             |
| `experimental.featureFlags`                       | List of developer feature flags                                                                                                                                                                   | `[]`                                                                             |
| `agents`                                          | Configure multiple agent DaemonSets. Useful when you have different node types and nodeAttestors                                                                                                  | `{}`                                                                             |
| `installAndUpgradeHook.enabled`                   | Enable Helm hook to autofix common install/upgrade issues (should be disabled when using `helm template`)                                                                                         | `true`                                                                           |
| `tools.kubectl.image.registry`                    | The OCI registry to pull the image from                                                                                                                                                           | `docker.io`                                                                      |
| `tools.kubectl.image.repository`                  | The repository within the registry                                                                                                                                                                | `rancher/kubectl`                                                                |
| `tools.kubectl.image.pullPolicy`                  | The image pull policy                                                                                                                                                                             | `IfNotPresent`                                                                   |
| `tools.kubectl.image.tag`                         | Overrides the image tag whose default is the chart appVersion                                                                                                                                     | `""`                                                                             |
| `sockets.hostBasePath`                            | Path on which the agent socket is made available when admin.mountOnHost is true                                                                                                                   | `/run/spire/agent/sockets`                                                       |
| `sockets.admin.enabled`                           | Enable the admin socket. Useful for admin tasks or the Delegated Identity API.                                                                                                                    | `false`                                                                          |
| `sockets.admin.mountOnHost`                       | Enable the admin socket to be visible on the host.                                                                                                                                                | `false`                                                                          |
